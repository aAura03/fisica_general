<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transferencia de Calor :: Simulador [CYBR-HT]</title>
    <!-- Ya no dependemos de un script externo de Tailwind, usamos CSS puro para garantizar la visibilidad -->
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos Base REFORZADOS - Usando CSS puro para evitar fallas de carga */
        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #0d1117 !important; /* Fondo oscuro obligatorio */
            color: #c9d1d9 !important; /* Gris claro visible para el texto por defecto */
            min-height: 100vh;
            padding: 2rem;
            margin: 0;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        .header-font {
            font-family: 'Major Mono Display', monospace;
        }
        /* Colores Neón */
        .neon-cyan { color: #00ffff; text-shadow: 0 0 5px #00ffff, 0 0 10px rgba(0, 255, 255, 0.4); }
        .text-fuchsia-400 { color: #ff00ff; }
        .text-cyan-400 { color: #00ffff; }

        /* Contenedores y Bordes de Respaldo */
        .fuchsia-glow-border {
            border: 2px solid #ff00ff;
            box-shadow: 0 0 8px #ff00ff, 0 0 15px rgba(255, 0, 255, 0.3);
            padding: 1.5rem;
            border-radius: 0.5rem;
            background-color: #1c212a; /* Fondo más claro para los módulos */
            margin-bottom: 1.5rem;
        }
        
        /* Inputs y Selects estilo terminal */
        .terminal-input {
            background-color: #1a2233;
            border: 1px solid #00ffff;
            color: #00ff00; 
            padding: 10px;
            border-radius: 4px;
            width: 100%;
            transition: all 0.3s;
            outline: none;
        }
        .terminal-input:focus {
            border-color: #ff00ff;
            box-shadow: 0 0 5px #ff00ff;
        }
        
        /* Output estilo registro */
        .terminal-output {
            background-color: #0a111a;
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 15px;
            min-height: 80px;
            overflow-y: auto;
            border-radius: 6px;
        }
        
        /* Botones de Control */
        .action-button {
            background-color: #00ffff;
            color: #1a2233;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 4px;
            transition: all 0.3s;
            cursor: pointer;
            text-align: center;
        }
        .action-button:hover {
            background-color: #ff00ff;
            color: #0d1117;
            box-shadow: 0 0 10px #ff00ff;
        }

        /* Navegación por Pestañas */
        .nav-button {
            padding: 0.75rem 1rem;
            font-size: 1.125rem;
            color: #9ca3af;
            transition: color 0.3s;
            border: none;
            background: none;
            cursor: pointer;
        }
        .nav-button:hover {
            color: #00ffff;
        }
        .tab-active {
            border-bottom: 3px solid #ff00ff !important;
            color: #ff00ff !important;
            text-shadow: 0 0 5px #ff00ff;
        }

        /* Canvas */
        #conductionCanvas {
            max-width: 100%;
            width: 100%; /* Forzado para ancho completo */
            height: 150px; /* Altura fija inicial */
            background-color: #000;
        }

        /* Tooltip de Ayuda */
        .help-icon-container {
            position: relative;
            display: inline-block;
        }
        .help-tooltip {
            visibility: hidden;
            background-color: #1a2233;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            border: 1px solid #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        .help-icon-container:hover .help-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .help-icon {
            display: inline-block;
            cursor: pointer;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            border-radius: 50%;
            background-color: #ff00ff;
            color: #0d1117;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* Utilidades de Flexbox y Grid (reemplazo simple de Tailwind) */
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: 1fr; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .xl\:grid-cols-5 { grid-template-columns: repeat(5, 1fr); }
        .xl\:col-span-2 { grid-column: span 2 / span 2; }
        .xl\:col-span-3 { grid-column: span 3 / span 3; }
        .gap-6 { gap: 1.5rem; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }
        .hidden { display: none !important; }

        /* Margins y Paddings */
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }

        /* Media Query para Desktop (xl) */
        @media (min-width: 1280px) {
            .grid-desktop {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- Encabezado de la Aplicación -->
    <header style="margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #00ffff;">
        <h1 class="header-font" style="font-size: 2.5rem; color: #00ffff; margin-bottom: 0.5rem; text-shadow: 0 0 5px #00ffff;">
            [[ MÓDULO HT-404 :: TRANSFERENCIA DE CALOR ]]
        </h1>
        <p style="font-size: 1.125rem; color: #ff00ff;">
            &gt; Inicializando Sesión. Usuario: <span class="header-font" style="font-size: 1.25rem; color: #ffff00;">Aura Romero</span>
        </p>
    </header>

    <!-- Navegación por Pestañas -->
    <nav class="flex" style="border-bottom: 1px solid #4b5563; margin-bottom: 2rem;">
        <button id="tab-home" onclick="showSection('home')" class="nav-button tab-active">
            &gt; 01 INICIO
        </button>
        <button id="tab-theory" onclick="showSection('theory')" class="nav-button">
            &gt; 02 TEORÍA
        </button>
        <button id="tab-calculator" onclick="showSection('calculator')" class="nav-button">
            &gt; 03 CALCULADORA
        </button>
        <button id="tab-simulator" onclick="showSection('simulator')" class="nav-button">
            &gt; 04 SIMULADOR
        </button>
    </nav>

    <!-- Contenedor Principal de las Secciones -->
    <main>
        <!-- Sección 1: INICIO -->
        <section id="home" class="content-section">
            <h2 class="header-font neon-cyan" style="font-size: 2rem; margin-bottom: 1rem;">TRANSFERENCIA DE ENERGÍA TÉRMICA</h2>
            <div class="fuchsia-glow-border">
                <p style="font-size: 1.25rem; color: #00ff00; margin-bottom: 1rem;">
                    [Sistema Activo] Bienvenido, Operador Aura Romero. El ambiente es estable.
                </p>
                <p style="margin-bottom: 1rem;">
                    Este módulo está diseñado para explorar los mecanismos fundamentales de la transferencia de calor y sus efectos en la materia. El calor es la energía que fluye debido a una diferencia de temperatura. El objetivo de este sistema es llevar al equilibrio.
                </p>
                <ul style="list-style: disc; padding-left: 1.5rem; color: #00ffff;">
                    <li>Conducción: Contacto directo.</li>
                    <li>Convección: Movimiento de fluidos.</li>
                    <li>Radiación: Ondas electromagnéticas.</li>
                </ul>
            </div>
        </section>

        <!-- Sección 2: TEORÍA -->
        <section id="theory" class="content-section hidden">
            <h2 class="header-font neon-cyan" style="font-size: 2rem; margin-bottom: 1rem;">LEY CERO Y PRIMERA LEY</h2>

            <!-- LEY CERO DE LA TERMODINÁMICA -->
            <div class="fuchsia-glow-border" style="margin-bottom: 1.5rem;">
                <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #ff0;">0. LEY CERO</h3>
                <p>
                    Si un sistema A está en equilibrio térmico con un sistema C, y un sistema B también está en equilibrio térmico con un sistema C, entonces A y B están en equilibrio térmico entre sí. Esto define la **temperatura** como una propiedad medible.
                </p>
            </div>

            <!-- PRIMERA LEY DE LA TERMODINÁMICA -->
            <div class="fuchsia-glow-border" style="margin-bottom: 1.5rem;">
                <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #ff0;">1. PRIMERA LEY (Conservación de Energía)</h3>
                <p>
                    La energía no se crea ni se destruye, solo se transforma. En términos de calor, el cambio en la energía interna (ΔU) de un sistema es igual al calor neto transferido hacia o desde el sistema (Q) más el trabajo neto realizado por o sobre el sistema (W).
                </p>
                <!-- FÓRMULA CLAVE - Texto plano/Unicode -->
                <p class="terminal-output header-font" style="font-size: 1.125rem; text-align: center; margin-top: 0.75rem;">
                    Fórmula Clave: ΔU = Q - W
                </p>
            </div>

            <h3 class="header-font neon-cyan" style="font-size: 2rem; margin-bottom: 1rem; margin-top: 2rem;">FORMULACIÓN DE TRANSFERENCIA DE CALOR</h3>

            <!-- FÓRMULA DE CALOR ESPECÍFICO (Q) -->
            <div style="padding: 1.5rem; border-radius: 0.5rem; background-color: #1a2233; border: 1px solid #00ffff; margin-bottom: 1.5rem;">
                <h4 class="header-font text-green-400" style="font-size: 1.25rem; margin-bottom: 0.5rem; color: #0f0;">Cálculo de Energía Interna (Q)</h4>
                <p>
                    La energía térmica requerida para cambiar la temperatura de una masa de sustancia se calcula con el calor específico (c):
                </p>
                <!-- FÓRMULA CLAVE - Texto plano/Unicode -->
                <p class="terminal-output header-font" style="font-size: 1.125rem; text-align: center; margin-top: 0.75rem;">
                    Fórmula: Q = m · c · ΔT
                </p>
                <!-- Texto plano para unidades -->
                <p style="margin-top: 0.5rem; font-size: 0.875rem; color: #9ca3af;">
                    Donde: Q (Joules o Calorías), m (masa en kg), c (calor específico en J/kg·K), ΔT (cambio de temperatura en K o °C).
                </p>
            </div>

            <!-- TABLA DE CALORES ESPECÍFICOS -->
            <h4 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #ff0;">DATABASE::Calores Específicos c (Aprox. J/kg·K)</h4>
            <div class="fuchsia-glow-border" style="overflow-x: auto; border-radius: 0.5rem;">
                <table style="width: 100%; text-align: left; font-size: 0.875rem; color: #00ffff;">
                    <thead style="font-size: 0.75rem; text-transform: uppercase; background-color: rgba(10, 17, 26, 0.8); color: #ff00ff;">
                        <tr>
                            <th scope="col" style="padding: 0.75rem 1.5rem;">Material</th>
                            <th scope="col" style="padding: 0.75rem 1.5rem;">Valor (J/kg·K)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid #4b5563;">
                            <td style="padding: 1rem 1.5rem; font-weight: 500; white-space: nowrap;">Agua (Líquida)</td>
                            <td style="padding: 1rem 1.5rem;">4186</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #4b5563;">
                            <td style="padding: 1rem 1.5rem; font-weight: 500; white-space: nowrap;">Hielo</td>
                            <td style="padding: 1rem 1.5rem;">2090</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #4b5563;">
                            <td style="padding: 1rem 1.5rem; font-weight: 500; white-space: nowrap;">Aluminio</td>
                            <td style="padding: 1rem 1.5rem;">900</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #4b5563;">
                            <td style="padding: 1rem 1.5rem; font-weight: 500; white-space: nowrap;">Cobre</td>
                            <td style="padding: 1rem 1.5rem;">385</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem 1.5rem; font-weight: 500; white-space: nowrap;">Vidrio</td>
                            <td style="padding: 1rem 1.5rem;">840</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Sección 3: CALCULADORA -->
        <section id="calculator" class="content-section hidden">
            <!-- TÍTULO - Usamos Unicode para el Delta (Δ) -->
            <h2 class="header-font neon-cyan" style="font-size: 2rem; margin-bottom: 1rem;">MÓDULO DE CÁLCULO Q=mcΔT</h2>

            <div class="fuchsia-glow-border grid" style="grid-template-columns: 1fr; gap: 1.5rem;">
                <!-- Columna de Entradas -->
                <div>
                    <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-bottom: 1rem; color: #ff0;">:: INGRESO DE PARÁMETROS ::</h3>

                    <div class="mb-4">
                        <!-- Etiqueta con texto plano -->
                        <label for="material-select" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Material (c)</label>
                        <select id="material-select" class="terminal-input">
                            <option value="4186">Agua (4186 J/kg·K)</option>
                            <option value="2090">Hielo (2090 J/kg·K)</option>
                            <option value="900">Aluminio (900 J/kg·K)</option>
                            <option value="385">Cobre (385 J/kg·K)</option>
                            <option value="840">Vidrio (840 J/kg·K)</option>
                            <option value="1000">Personalizado (1000 J/kg·K)</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="specific-heat" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Calor Específico Personalizado [J/kg·K]</label>
                        <input type="number" id="specific-heat" value="4186" placeholder="c (J/kg·K)" class="terminal-input" step="1">
                    </div>

                    <div class="mb-4">
                        <!-- Etiqueta con texto plano -->
                        <label for="mass" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Masa (m) [kg]</label>
                        <input type="number" id="mass" value="1.0" placeholder="Masa (kg)" class="terminal-input" step="0.1">
                    </div>

                    <div class="mb-4">
                        <!-- Etiqueta con texto plano -->
                        <label for="temp-initial" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Temperatura Inicial (Tᵢ) [°C]</label>
                        <input type="number" id="temp-initial" value="20" placeholder="Temperatura Inicial (°C)" class="terminal-input" step="1">
                    </div>

                    <div class="mb-6">
                        <!-- Etiqueta con texto plano -->
                        <label for="temp-final" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Temperatura Final (Tꜰ) [°C]</label>
                        <input type="number" id="temp-final" value="50" placeholder="Temperatura Final (°C)" class="terminal-input" step="1">
                    </div>

                    <button onclick="calculateHeat()" class="action-button" style="width: 100%;">
                        [[ EJECUTAR CÁLCULO DE Q ]]
                    </button>
                </div>

                <!-- Columna de Resultados y Sustitución -->
                <div>
                    <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-bottom: 1rem; color: #ff0;">:: REGISTRO DE CÁLCULO ::</h3>

                    <div id="substitution-area" class="terminal-output" style="margin-bottom: 1.5rem;">
                        <!-- FÓRMULA DE PARTIDA - Usamos Unicode -->
                        <p style="font-size: 0.875rem; color: #ff00ff;" class="header-font">Fórmula de partida: Q = m · c · (Tꜰ - Tᵢ)</p>
                        <p>Esperando parámetros...</p>
                    </div>

                    <h3 class="header-font text-green-400" style="font-size: 1.5rem; margin-bottom: 1rem; color: #0f0; margin-top: 1.5rem;">:: RESULTADO Q (ENERGÍA REQUERIDA) ::</h3>

                    <div id="result-area" class="terminal-output" style="font-size: 1.5rem; font-weight: bold; text-align: center;">
                        <span class="neon-cyan">0.00 J</span>
                    </div>

                    <p style="font-size: 0.75rem; margin-top: 0.5rem; color: #9ca3af;">
                        *Nota: Un valor positivo indica aumento de temperatura (ganancia de energía). Un valor negativo indica disminución de temperatura (pérdida de energía).
                    </p>
                </div>
            </div>
        </section>

        <!-- Sección 4: SIMULADOR (Conducción 1D) -->
        <section id="simulator" class="content-section hidden">
            <h2 class="header-font neon-cyan" style="font-size: 2rem; margin-bottom: 1rem;">SIMULADOR 1D :: CONDUCCIÓN ESTACIONARIA</h2>

            <div class="fuchsia-glow-border grid grid-desktop" style="grid-template-columns: 1fr; gap: 1.5rem;">

                <!-- Columna de Controles y Ejemplos (Columna 1) -->
                <div style="grid-column: span 2 / span 2;">
                    <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-bottom: 1rem; color: #ff0;">:: ENTRADAS DE SIMULACIÓN ::</h3>

                    <div class="mb-4">
                        <label for="temp-hot" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Temperatura Caliente (T_Cal) [°C]</label>
                        <input type="number" id="temp-hot" value="100" placeholder="T Caliente (°C)" class="terminal-input" step="10">
                    </div>

                    <div class="mb-4">
                        <label for="temp-cold" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Temperatura Fría (T_Fría) [°C]</label>
                        <input type="number" id="temp-cold" value="0" placeholder="T Fría (°C)" class="terminal-input" step="10">
                    </div>

                    <div class="mb-4">
                        <label for="k-material" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Conductividad Térmica (k) [W/m·K]</label>
                        <input type="number" id="k-material" value="200" placeholder="k (W/m·K) ej. Aluminio=200, Vidrio=1.1" class="terminal-input" step="1">
                        <p style="font-size: 0.75rem; margin-top: 0.25rem; color: #6b7280;">*Alto k = Buen Conductor (Ej. Metales)</p>
                    </div>

                    <div class="mb-6">
                        <label for="initial-temp" class="block text-cyan-400" style="margin-bottom: 0.5rem;">Temperatura Inicial del Material (T_Inicial) [°C]</label>
                        <input type="number" id="initial-temp" value="20" placeholder="T Inicial (°C)" class="terminal-input" step="1">
                    </div>

                    <!-- Botones de Control -->
                    <div class="grid grid-cols-2 gap-6" style="margin-bottom: 1.5rem;">
                        <button onclick="startConductionSimulation()" class="action-button">
                            [[ INICIAR SIMULACIÓN ]]
                        </button>
                        <button onclick="stopConductionSimulation()" class="action-button" style="background-color: #dc2626; --tw-shadow-color: #dc2626;" onmouseover="this.style.backgroundColor='#ef4444'; this.style.boxShadow='0 0 10px #ef4444'" onmouseout="this.style.backgroundColor='#dc2626'; this.style.boxShadow='none'">
                            [[ DETENER PROCESO ]]
                        </button>
                    </div>
                    <button onclick="resetSimulation()" class="action-button" style="width: 100%; background-color: #d97706; --tw-shadow-color: #d97706;" onmouseover="this.style.backgroundColor='#fbbf24'; this.style.boxShadow='0 0 10px #fbbf24'" onmouseout="this.style.backgroundColor='#d97706'; this.style.boxShadow='none'">
                        [[ REINICIAR / LIMPIAR SIMULACIÓN ]]
                    </button>
                    
                    <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; margin-bottom: 1rem; margin-top: 2rem; color: #ff0;">:: EJEMPLOS (PREAJUSTES) ::</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                         <button onclick="loadExample('cuchara')" class="action-button" style="width: 100%; background-color: #0c4a6e; --tw-shadow-color: #0c4a6e;" onmouseover="this.style.backgroundColor='#0ea5e9'; this.style.boxShadow='0 0 10px #0ea5e9'" onmouseout="this.style.backgroundColor='#0c4a6e'; this.style.boxShadow='none'">
                            Cuchara de Metal en Sopa
                        </button>
                        <button onclick="loadExample('ventana')" class="action-button" style="width: 100%; background-color: #0c4a6e; --tw-shadow-color: #0c4a6e;" onmouseover="this.style.backgroundColor='#0ea5e9'; this.style.boxShadow='0 0 10px #0ea5e9'" onmouseout="this.style.backgroundColor='#0c4a6e'; this.style.boxShadow='none'">
                            Ventana de Vidrio en Invierno
                        </button>
                         <button onclick="loadExample('ladrillo')" class="action-button" style="width: 100%; background-color: #0c4a6e; --tw-shadow-color: #0c4a6e;" onmouseover="this.style.backgroundColor='#0ea5e9'; this.style.boxShadow='0 0 10px #0ea5e9'" onmouseout="this.style.backgroundColor='#0c4a6e'; this.style.boxShadow='none'">
                            Pared de Ladrillo (Aislante)
                        </button>
                        <div id="example-explanation" class="terminal-output" style="margin-top: 0.75rem; font-size: 0.875rem; min-height: 50px;">
                            Selecciona un ejemplo para cargar los parámetros de simulación.
                        </div>
                    </div>
                </div>

                <!-- Columna de Visualización y Datos (Columnas 2, 3) -->
                <div style="grid-column: span 3 / span 3;">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="header-font text-yellow-400" style="font-size: 1.5rem; color: #ff0;">:: VISUALIZACIÓN DE FLUJO (Barra 1D) ::</h3>
                        <!-- Icono de Ayuda / Tooltip -->
                        <div class="help-icon-container">
                            <span class="help-icon">?</span>
                            <div class="help-tooltip">
                                <h4 class="text-fuchsia-400 header-font" style="font-size: 1.125rem; margin-bottom: 0.25rem;">Modelo de Conducción 1D</h4>
                                <p style="font-size: 0.875rem;">
                                    Esta simulación muestra cómo se propaga el calor (Conducción) a lo largo de una barra. El extremo **Caliente** (izquierda) intenta transferir energía al extremo **Frío** (derecha).
                                </p>
                                <ul style="list-style: disc; padding-left: 1.5rem; margin-top: 0.5rem; font-size: 0.75rem;">
                                    <li style="color: #ff00ff;">**Fucsia/Rojo:** Alta Temperatura.</li>
                                    <li style="color: #00ffff;">**Cian/Azul:** Baja Temperatura.</li>
                                    <li>La **Conductividad (k)** determina la velocidad de transferencia.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div style="position: relative; border-radius: 0.5rem; padding: 0.5rem; border: 2px solid #ff00ff; box-shadow: 0 0 8px #ff00ff;">
                        <!-- Canvas de Simulación -->
                        <canvas id="conductionCanvas" width="600" height="150" class="w-full"></canvas>
                        <div class="flex justify-between" style="font-size: 0.875rem; margin-top: 0.25rem; color: #00ffff;">
                            <span class="neon-cyan">CALIENTE</span>
                            <span class="text-fuchsia-400">FRÍO</span>
                        </div>
                        <p id="time-display" style="font-size: 0.875rem; color: #00ff00; margin-top: 0.5rem; text-align: center;">[Tiempo Simulado: 0.0 s]</p>
                        <p id="status-message" style="font-size: 0.875rem; text-align: center; margin-top: 0.25rem;">Simulación detenida. Presiona "Iniciar" para comenzar.</p>
                    </div>

                    <h4 class="header-font text-green-400" style="font-size: 1.25rem; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #0f0;">ESCALA DE COLOR (T°C)</h4>
                    <div id="color-bar-container" style="width: 100%; height: 2rem; border: 2px solid #ff00ff; border-radius: 0.5rem; position: relative; overflow: hidden;">
                    </div>

                    <!-- Tabla de Registro de Temperaturas -->
                    <h4 class="header-font text-yellow-400" style="font-size: 1.25rem; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #ff0;">REGISTRO DE TEMPERATURA CENTRAL</h4>
                    <div style="overflow-y: auto; max-height: 10rem; border: 2px solid #ff00ff; border-radius: 0.5rem;">
                        <table style="width: 100%; text-align: left; font-size: 0.875rem; color: #00ffff;">
                            <thead style="font-size: 0.75rem; text-transform: uppercase; background-color: rgba(10, 17, 26, 0.8); color: #ff00ff; position: sticky; top: 0;">
                                <tr>
                                    <th scope="col" style="padding: 0.5rem 1.5rem;">Tiempo (s)</th>
                                    <th scope="col" style="padding: 0.5rem 1.5rem;">T° Central (ºC)</th>
                                </tr>
                            </thead>
                            <tbody id="temp-log">
                                <!-- Datos de registro se insertarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    <p style="font-size: 0.75rem; margin-top: 0.25rem; color: #6b7280;">*La T° Central es el punto medio (Nodo 25) del material.</p>
                </div>
            </div>
        </section>
    </main>

    <script type="text/javascript">
        // Variables globales para la aplicación
        let activeSection = 'home';
        let animationFrameId = null; // Para controlar la animación del simulador
        let NODE_COUNT = 50;
        let temperatures = new Array(NODE_COUNT).fill(0);
        let T_min = 0;
        let T_max = 100;
        let simulationRunning = false;
        let timeElapsed = 0;
        let lastLogTime = 0;
        let logInterval = 1.0; // Registrar cada 1.0 segundo simulado

        // --- Funciones de Utilidad y Estilos ---

        /**
         * Cambia la sección visible y actualiza el estilo de la pestaña activa.
         * @param {string} sectionId - El ID de la sección a mostrar.
         */
        function showSection(sectionId) {
            // Oculta todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
                section.classList.add('hidden'); // Aseguramos que la clase hidden esté
            });

            // Remueve el estilo activo de todas las pestañas
            document.querySelectorAll('nav button').forEach(button => {
                button.classList.remove('tab-active');
            });

            // Muestra la sección deseada
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                targetSection.classList.remove('hidden');
            }

            // Establece el estilo activo en la pestaña correspondiente
            const targetTab = document.getElementById('tab-' + sectionId);
            if (targetTab) {
                targetTab.classList.add('tab-active');
            }

            activeSection = sectionId;

            // Detener simulación si se cambia de pestaña
            if (sectionId !== 'simulator') {
                stopConductionSimulation();
            }
        }

        // --- MÓDULO 03: CALCULADORA ---

        /**
         * Calcula el calor transferido (Q) usando Q = m * c * ΔT.
         */
        function calculateHeat() {
            try {
                // Obtener valores de entrada
                const mass = parseFloat(document.getElementById('mass').value);
                const tempInitial = parseFloat(document.getElementById('temp-initial').value);
                const tempFinal = parseFloat(document.getElementById('temp-final').value);
                
                // Obtener calor específico (c)
                const materialSelect = document.getElementById('material-select');
                let specificHeat = parseFloat(materialSelect.value);

                // Si se selecciona "Personalizado", usa el valor del input de texto
                if (materialSelect.value === '1000' || isNaN(specificHeat)) {
                    specificHeat = parseFloat(document.getElementById('specific-heat').value);
                } else {
                     document.getElementById('specific-heat').value = specificHeat;
                }
                
                // Validar entradas
                if (isNaN(mass) || isNaN(tempInitial) || isNaN(tempFinal) || isNaN(specificHeat) || mass <= 0 || specificHeat <= 0) {
                    throw new Error("ERROR [0x01]:: Parámetros de entrada inválidos. Asegúrate de que todos los campos sean números positivos y válidos.");
                }

                const deltaT = tempFinal - tempInitial;
                const Q = mass * specificHeat * deltaT;

                // Actualizar área de sustitución (¡CORREGIDO A UNICODE Y CARACTERES SIMPLES!)
                const substitutionHtml = `
                    <p style="font-size: 0.875rem; color: #ff00ff;" class="header-font">Fórmula de partida: Q = m · c · (Tꜰ - Tᵢ)</p>
                    <p style="color: #00ff00; margin-top: 0.5rem;">Sustitución:</p>
                    <p style="font-size: 0.875rem;">Q = (${mass} kg) · (${specificHeat} J/kg·K) · (${tempFinal}°C - ${tempInitial}°C)</p>
                    <p style="font-size: 0.875rem;">Q = (${mass} kg) · (${specificHeat} J/kg·K) · (${deltaT.toFixed(2)} K)</p>
                    <p style="font-size: 0.875rem; margin-top: 0.5rem; color: ${Q < 0 ? '#ff4444' : '#00ff00'};">
                        RESULTADO :: ${Q.toFixed(2)} J
                    </p>
                `;
                document.getElementById('substitution-area').innerHTML = substitutionHtml;

                // Actualizar área de resultado
                document.getElementById('result-area').innerHTML = `
                    <span class="neon-cyan">${Q.toFixed(2)} J</span>
                `;

            } catch (error) {
                document.getElementById('substitution-area').innerHTML = `<p style="color: #ff4444;">ERROR [0x02]:: ${error.message}</p>`;
                document.getElementById('result-area').innerHTML = `<span style="color: #ff4444;">--- ERROR ---</span>`;
                console.error(error);
            }
        }

        document.getElementById('material-select').addEventListener('change', function() {
            const heatInput = document.getElementById('specific-heat');
            if (this.value === '1000') {
                heatInput.disabled = false;
                heatInput.value = '1000'; // Valor predeterminado para personalizado
            } else {
                heatInput.value = this.value;
                heatInput.disabled = true;
            }
        });
        
        // Inicializa el estado del input personalizado
        // Llamado en DOMContentLoaded

        // --- MÓDULO 04: SIMULADOR DE CONDUCCIÓN 1D ---

        const canvas = document.getElementById('conductionCanvas');
        const ctx = canvas.getContext('2d');
        
        // Mapas de ejemplos pre-simulados
        const EXAMPLES = {
            'cuchara': {
                T_Cal: 95, T_Fria: 20, T_Inicial: 20, k: 380, // Cobre/Acero alto k
                expl: "La alta conductividad del metal (k) significa que el calor se transfiere muy rápido de la sopa (T_Cal) a la mano (T_Fría). La cuchara se calienta en segundos."
            },
            'ventana': {
                T_Cal: 25, T_Fria: -5, T_Inicial: 10, k: 1.1, // Vidrio bajo k
                expl: "La baja conductividad del vidrio hace que la transferencia de calor sea lenta. La ventana actúa como un aislante moderado, impidiendo que el calor de la habitación (T_Cal) escape rápidamente al exterior (T_Fría)."
            },
            'ladrillo': {
                T_Cal: 30, T_Fria: 10, T_Inicial: 20, k: 0.72, // Ladrillo muy bajo k
                expl: "El ladrillo es un aislante pobre, con k muy bajo. La transferencia de calor es extremadamente lenta, lo que permite que una pared mantenga estable la temperatura interior durante mucho tiempo."
            }
        };

        /**
         * Carga un ejemplo preestablecido en los inputs de la simulación.
         * @param {string} exampleKey - La clave del ejemplo a cargar.
         */
        function loadExample(exampleKey) {
            const example = EXAMPLES[exampleKey];
            if (example) {
                // Detener y resetear primero
                stopConductionSimulation();
                resetInternalVariables(); // Reinicia solo variables internas y log, no inputs

                // Cargar los valores del ejemplo
                document.getElementById('temp-hot').value = example.T_Cal;
                document.getElementById('temp-cold').value = example.T_Fria;
                document.getElementById('initial-temp').value = example.T_Inicial;
                document.getElementById('k-material').value = example.k;
                
                // Mostrar la explicación
                document.getElementById('example-explanation').textContent = "Ejemplo cargado: " + example.expl;
                
                // *** AQUÍ ESTÁ LA CLAVE: Inicializar y dibujar para la visualización instantánea ***
                const T_hot = example.T_Cal;
                const T_cold = example.T_Fria;
                const T_initial = example.T_Inicial;

                T_min = Math.min(T_hot, T_cold, T_initial);
                T_max = Math.max(T_hot, T_cold, T_initial);
                if (T_max === T_min) T_max += 1;

                temperatures.fill(T_initial); // Llenar con T_Inicial
                temperatures[0] = T_hot;
                temperatures[NODE_COUNT - 1] = T_cold;

                generateColorBar(); // Actualizar la escala de color
                drawConduction(); // Dibujar la barra inicial
                document.getElementById('status-message').textContent = "Ejemplo cargado. Presiona 'Iniciar' para ver el flujo de calor.";

            } else {
                document.getElementById('example-explanation').textContent = "ERROR [0x05]:: Ejemplo no encontrado.";
            }
        }

        /**
         * Mapea un valor numérico a un color en un degradado de calor.
         * De cian (frío) a fucsia (caliente).
         * @param {number} value - La temperatura del nodo (entre T_min y T_max).
         * @returns {string} Código de color CSS (e.g., 'rgb(r,g,b)').
         */
        function getColorForTemp(value) {
            const ratio = (value - T_min) / (T_max - T_min);
            
            // Colores: Cian (0) a Fucsia (1)
            const FUCHSIA = [255, 0, 255];
            const CYAN = [0, 255, 255];

            // Interpolación lineal
            let r = Math.floor(CYAN[0] + (FUCHSIA[0] - CYAN[0]) * ratio);
            let g = Math.floor(CYAN[1] + (FUCHSIA[1] - CYAN[1]) * ratio);
            let b = Math.floor(CYAN[2] + (FUCHSIA[2] - CYAN[2]) * ratio);
            
            r = Math.max(0, Math.min(255, r));
            g = Math.max(0, Math.min(255, g));
            b = Math.max(0, Math.min(255, b));
            
            return `rgb(${r}, ${g}, ${b})`;
        }

        /**
         * Dibuja el estado actual de la barra 1D en el canvas.
         */
        function drawConduction() {
            // Asegurar que el canvas tiene el ancho correcto
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth - 10; // -10 para padding/borde

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const barHeight = canvas.height * 0.5;
            const barY = (canvas.height - barHeight) / 2;
            const nodeWidth = canvas.width / NODE_COUNT;

            // Dibujar la barra segmentada con colores de temperatura
            for (let i = 0; i < NODE_COUNT; i++) {
                const x = i * nodeWidth;
                const temp = temperatures[i];
                ctx.fillStyle = getColorForTemp(temp);
                ctx.fillRect(x, barY, nodeWidth + 1, barHeight); // +1 para evitar huecos

                // Dibuja la cuadrícula Cyberpunk
                ctx.strokeStyle = 'rgba(30, 58, 138, 0.5)';
                ctx.strokeRect(x, barY, nodeWidth, barHeight);
            }

            // Marcar los extremos (Condiciones de frontera)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.fillRect(0, barY, 5, barHeight); // Extremo caliente
            ctx.fillRect(canvas.width - 5, barY, 5, barHeight); // Extremo frío
        }

        /**
         * Genera la barra de escala de color.
         */
        function generateColorBar() {
            const container = document.getElementById('color-bar-container');
            if (!container) return; // Chequeo de seguridad

            const numSegments = 100;
            let gradientStyle = 'linear-gradient(to right, ';
            
            // Generar el degradado del frío al caliente
            for(let i = 0; i <= numSegments; i++) {
                const temp = T_min + (T_max - T_min) * (i / numSegments);
                gradientStyle += getColorForTemp(temp) + (i < numSegments ? ', ' : '');
            }
            gradientStyle += ')';
            container.style.background = gradientStyle;
            
            // Añadir etiquetas (puntos clave)
            container.innerHTML = `
                <span style="position:absolute; left:0%; top:50%; transform:translateY(-50%); font-size:12px; color:#00ffff; background: #1c212a; padding: 2px;">${T_min}°C</span>
                <span style="position:absolute; right:0%; top:50%; transform:translateY(-50%); font-size:12px; color:#ff00ff; background: #1c212a; padding: 2px;">${T_max}°C</span>
            `;
        }

        /**
         * Registra la temperatura central en la tabla.
         */
        function logTemperature() {
            // Índice del nodo central (o el más cercano al centro)
            const centerNodeIndex = Math.floor(NODE_COUNT / 2);
            const centerTemp = temperatures[centerNodeIndex];

            const tableBody = document.getElementById('temp-log');
            
            // Añadir una nueva fila al inicio de la tabla
            const newRow = tableBody.insertRow(0); 
            newRow.style.borderBottom = '1px solid #4b5563';

            const timeCell = newRow.insertCell(0);
            timeCell.style.padding = '0.5rem 1.5rem';
            timeCell.style.fontWeight = '500';
            timeCell.style.whiteSpace = 'nowrap';
            timeCell.textContent = timeElapsed.toFixed(1);

            const tempCell = newRow.insertCell(1);
            tempCell.style.padding = '0.5rem 1.5rem';
            tempCell.style.fontWeight = '500';
            tempCell.style.whiteSpace = 'nowrap';
            tempCell.textContent = centerTemp.toFixed(2);
        }


        /**
         * Aplica el método de diferencias finitas para un paso de tiempo.
         */
        function updateConduction() {
            // Parámetros físicos (simplificados para estabilidad y demostración)
            const k = parseFloat(document.getElementById('k-material').value) || 200; // Conductividad Térmica [W/m·K]
            const rho = 7800; // Densidad (Acero) [kg/m³] - Fija
            const c = 460;   // Calor Específico (Acero) [J/kg·K] - Fija
            const L = 1.0;   // Longitud de la barra [m] - Fija

            // Parámetros numéricos
            const dx = L / (NODE_COUNT - 1); // Distancia entre nodos
            const dt = 0.001; // Pequeño paso de tiempo (simulado)
            
            // Difusividad térmica (alpha = k / (rho * c))
            const alpha = k / (rho * c);

            // Número de Fourier (Fo = alpha * dt / dx^2): debe ser <= 0.5 para estabilidad
            const Fo = (alpha * dt) / (dx * dx);
            
            // Usar Fo estable para evitar inestabilidad (0.45 es seguro)
            const FoStable = Math.min(Fo, 0.45); 

            let newTemperatures = [...temperatures];

            // Aplicar las condiciones de frontera de Dirichilet
            const T_hot = parseFloat(document.getElementById('temp-hot').value) || 100;
            const T_cold = parseFloat(document.getElementById('temp-cold').value) || 0;
            newTemperatures[0] = T_hot;
            newTemperatures[NODE_COUNT - 1] = T_cold;

            // Recorrer los nodos intermedios
            for (let i = 1; i < NODE_COUNT - 1; i++) {
                // Ecuación de conducción de calor 1D (Diferencias Finitas Explícitas)
                newTemperatures[i] = temperatures[i] + FoStable * (temperatures[i - 1] - 2 * temperatures[i] + temperatures[i + 1]);
            }

            temperatures = newTemperatures;
            timeElapsed += dt;
            
            // Loguear datos en la tabla cada segundo simulado
            if (timeElapsed - lastLogTime >= logInterval) {
                logTemperature();
                lastLogTime = timeElapsed;
            }
        }

        /**
         * Bucle principal de la simulación.
         */
        function simulationLoop(timestamp) {
            if (!simulationRunning) return;

            // Iteraciones por frame para acelerar la simulación
            const iterationsPerFrame = 50; 

            for(let i = 0; i < iterationsPerFrame; i++) {
                updateConduction();
            }

            drawConduction();

            // Actualizar el tiempo simulado
            document.getElementById('time-display').textContent = `[Tiempo Simulado: ${timeElapsed.toFixed(3)} s]`;
            
            animationFrameId = requestAnimationFrame(simulationLoop);
        }

        /**
         * Inicializa y comienza la simulación.
         */
        function startConductionSimulation() {
            if (simulationRunning) {
                document.getElementById('status-message').textContent = "ERROR [0x03]:: Simulación ya en curso. Detener antes de reiniciar.";
                return;
            }

            try {
                // Reset de variables internas antes de iniciar, para obtener T_initial
                resetInternalVariables();
                
                const T_hot = parseFloat(document.getElementById('temp-hot').value) || 100;
                const T_cold = parseFloat(document.getElementById('temp-cold').value) || 0;
                const T_initial = parseFloat(document.getElementById('initial-temp').value) || 20;

                // Definir los límites de la escala de color
                T_min = Math.min(T_hot, T_cold, T_initial);
                T_max = Math.max(T_hot, T_cold, T_initial);
                
                // Asegurar un rango mínimo
                if (T_max === T_min) {
                    T_max += 1;
                }
                
                // Inicializar temperaturas
                temperatures.fill(T_initial);
                temperatures[0] = T_hot;
                temperatures[NODE_COUNT - 1] = T_cold;

                simulationRunning = true;
                
                // Generar barra de color (escala) y redibujar el canvas al tamaño correcto
                generateColorBar();
                drawConduction();
                logTemperature(); // Log inicial
                
                document.getElementById('time-display').textContent = `[Tiempo Simulado: 0.0 s]`;
                document.getElementById('status-message').textContent = "Simulación iniciada. Procesando...";

                animationFrameId = requestAnimationFrame(simulationLoop);

            } catch (error) {
                document.getElementById('status-message').textContent = `ERROR [0x04]:: ${error.message}`;
                console.error(error);
            }
        }

        /**
         * Detiene la simulación.
         */
        function stopConductionSimulation() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            simulationRunning = false;
            document.getElementById('status-message').textContent = "Simulación detenida por el usuario.";
            animationFrameId = null;
        }

        /**
         * Reinicia variables internas y el log.
         */
        function resetInternalVariables() {
            timeElapsed = 0;
            lastLogTime = 0;
            document.getElementById('temp-log').innerHTML = '';
            document.getElementById('time-display').textContent = `[Tiempo Simulado: 0.0 s]`;
        }

        /**
         * Reinicia la simulación a los valores iniciales.
         */
        function resetSimulation() {
            stopConductionSimulation();
            
            // Valores predeterminados de los inputs
            document.getElementById('temp-hot').value = 100;
            document.getElementById('temp-cold').value = 0;
            document.getElementById('initial-temp').value = 20;
            document.getElementById('k-material').value = 200;
            
            resetInternalVariables();
            
            // Variables de color
            T_min = 0;
            T_max = 100;
            temperatures.fill(20);

            // Limpiar explicación y mensajes
            document.getElementById('example-explanation').textContent = "Selecciona un ejemplo para cargar los parámetros de simulación.";
            document.getElementById('status-message').textContent = "Simulación reiniciada. Presiona 'Iniciar' para comenzar.";

            // Redibujar
            generateColorBar();
            drawConduction();
        }
        
        // Función para manejar el redimensionamiento del canvas (responsividad)
        function handleResize() {
            // Solo actualiza la visualización si estamos en la pestaña del simulador o si está corriendo
            if (activeSection === 'simulator' || simulationRunning) {
                drawConduction();
            }
        }
        window.addEventListener('resize', handleResize);


        // --- Inicialización ---
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa el estado del input personalizado de la Calculadora
            document.getElementById('specific-heat').disabled = true;

            // Asegurar que la sección de inicio es visible y activa al cargar
            showSection('home');
            
            // Inicializar la visualización de la barra (estado inicial)
            // Se realiza un reset completo para asegurar la visualización
            resetSimulation(); 
        });

    </script>
</body>
</html>
